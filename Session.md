# Session Management

This checklist is designed to ensure that user sessions on a website are secure. It includes a series of steps and best practices for protecting user data and preventing unauthorized access.

---

## Session Creation

|  #  | Items                                                                                                                                                                                                        | Severity |               Attacks               |                        Sources                        |
| :-: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------: | :---------------------------------: | :---------------------------------------------------: |
|  1  | Verify: Change the default session ID name set by the framework to a generic name as 'id' </br> Reason: Session ID name can disclose information about the application's framework and language being used   |   Low    |      `Information Disclosure`       |                     [SMCS](#SMCS)                     |
|  2  | Verify: The session ID must be at least 128 bits or 16 characters long </br> Reason: Provides enough entropy to make guessing challenging                                                                    |  Medium  |           `Bruteforcing`            |                     [SMCS](#SMCS)                     |
|  3  | Verify: The session ID name is meaningless, meaning it doesn't reveal any information about the app or the user </br> Reason: Prevent sensitive information from leaking                                     |   Low    |      `Information Disclosure`       |        [SMCS](#SMCS), [SP800-63B](#SP800-63B)         |
|  4  | Verify: The session ID has an entropy of at least 64 bits </br> Reason: Minimum randomness that makes guessing challenging                                                                                   |  Medium  |           `Bruteforcing`            | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#SP800-63B) |
|  5  | Verify: The session ID is generated by using cryptographically secure random function </br> Reason: Ensure that the ID value is random and cannot be predicted                                               |   High   | `Bruteforcing`, `Weak Cryptography` | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#SP800-63B) |
|  6  | Verify: The session ID is unique for each user </br> Reason: Prevent users from accessing someone else's account                                                                                             |   High   |           `Impersonation`           |                     [NIST](#nist)                     |
|  7  | Verify: The session mechanism provided by a modern framework is being used </br> Reason: Custom session mechanisms aren't thoroughly tested and may contain vulnerabilities                                  |   High   |            `Custom Code`            |                     [SMCS](#SMCS)                     |
|  8  | Verify: If an older version of a framework is being used, ensure that session mechanism isn't vulnerable </br> Reason: An attacker can compromise your session by using the publicly available vulnerability |   High   |       `Vulnerable Dependency`       |                     [SMCS](#SMCS)                     |

---

## Session Storage

|  #  | Items                                                                                                                                                                                                                                                                                                                                                                                                         | Severity |                          Attacks                           |                        Sources                        |
| :-: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: | :--------------------------------------------------------: | :---------------------------------------------------: |
|  1  | Verify: `Secure` attribute is enabled for cookies </br> Reason: Instructs the browser to send cookies through HTTPS                                                                                                                                                                                                                                                                                           |   High   | `Eavesdropping` <span style="opacity:0">`xxxxxxxxxx`</div> | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#SP800-63B) |
|  2  | Verify: `HttpOnly` attribute is enabled for cookies </br> Reason: Instructs web browsers not to allow scripts to prevent XSS                                                                                                                                                                                                                                                                                  |   High   |                    `Injection`, `Theft`                    | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#SP800-63B) |
|  3  | Verify: `SameSite` attribute is enabled for cookies </br> Reason: Instructs web browsers to only send the cookie to the specified domain and all subdomains                                                                                                                                                                                                                                                   |  Medium  |                           `CSRF`                           |             [SMCS](#SMCS), [ASVS](#ASVS)              |
|  4  | Verify: If `Domain` cookie attribute exists, ensure that the domain value is not too permissive </br> Reason: Ensures that cookies are only shared with the domain provided. Vulnerabilities in example.com might allow an attacker to get access to the session IDs from secure.example.com                                                                                                                  |  Medium  |                    `Session Hijacking`                     |             [SMCS](#SMCS), [ASVS](#ASVS)              |
|  5  | Verify: If `Path` cookie attribute exists, ensure it is as restrictive as possible to the application that makes use of the session ID </br> Reason: If the path is generic such as `/`, then there's a chance that important cookie, such as session ID, will be accessible throughout the site                                                                                                              |  Medium  |                          `Theft`                           |             [SMCS](#SMCS), [ASVS](#ASVS)              |
|  6  | Verify: If `Expires` and `Max-Age` attributes are used, a short expiration time is set to prevent long persistent cookies </br> Reason: Persistent cookies will outlive the close browser event. It is highly recommended to use non-persistent cookies for session management purposes so that the session ID does not remain on the web client cache for long periods, from where an attacker can obtain it |  Medium  |                          `Theft`                           |             [SMCS](#SMCS), [ASVS](#ASVS)              |
|  7  | Verify: The session ID is not stored in local storage </br> Reason: Local storage is insecure as it doesn't have protection against XSS attacks, and it's value is persistent unless changed manually in code                                                                                                                                                                                                 |   High   |                    `Injection`, `Theft`                    |                     [SMCS](#SMCS)                     |
|  8  | Verify: The session ID is not stored in session storage </br> Reason: Session storage data is persistent unless the tab or window is closed, and it is vulnerable to XSS                                                                                                                                                                                                                                      |   High   |                    `Injection`, `Theft`                    |                     [SMCS](#SMCS)                     |
|  9  | Verify: Ensure that session ID is not cached in browser </br> Reason: If logged in device is stolen or left unattended, someone else can have access to that account                                                                                                                                                                                                                                          |   Low    |                          `Theft`                           |                     [SMCS](#SMCS)                     |
| 10  | Verify: Session data is stored server side by using secure encryption and hashing algorithms </br> Reason: Provides additional security incase of a database compromise                                                                                                                                                                                                                                       |   High   |                          `Theft`                           |                     [SMCS](#SMCS)                     |

---

## Session Expiration

|  #  | Items                                                                                                                                                                                                                           | Severity |                Attacks                 |                     Sources                      |
| :-: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: | :------------------------------------: | :----------------------------------------------: |
|  1  | Verify: Session expires after a period of inactivity </br> Reason: Limits the time an attacker has to guess a session ID                                                                                                        |   High   |          `Session Hijacking`           | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#nist) |
|  2  | Verify: Expired session ID is no longer active </br> Reason: This ensures that incase an older session ID is stolen, it won't be of use                                                                                         |   High   |          `Session Hijacking`           | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#nist) |
|  3  | Verify: When the user clicks the logout button, the session is invalidated, and the user is asked to login </br> Reason: This ensures that an account is not accessible after a logout attempt                                  |   High   |         `Unauthorized Access`          | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#nist) |
|  4  | Verify: Allow the user to invalidate sessions on different devices </br> Reason: A stolen or old device doesn't give access to someone else                                                                                     |  Medium  | `Unauthorized Access`, `Impersonation` |           [SMCS](#SMCS), [ASVS](#ASVS)           |
|  5  | Verify: An application should have an absolute timeout after which a user is required to login regardless of their activity/inactivity </br> Reason: Additional security measure to ensure that session IDs are being refreshed |   Low    |          `Session Hijacking`           |                  [SMCS](#SMCS)                   |
|  6  | Verify: Timeout functionality isn't client based </br> Reason: An attacker is not able to manipulate the current time and continue their session for longer than intended                                                       |   Low    |          `Session Hijacking`           |                  [SMCS](#SMCS)                   |
|  7  | Verify: Session ID renewable process exists regardless of idle timeouts </br> Reason: This limits the amount of time a hacker can have access to a hijacked session                                                             |   Low    |          `Session Hijacking`           |                  [SMCS](#SMCS)                   |

---

## Session Policies

|  #  | Items                                                                                                                                                                                        | Severity |          Attacks          |                        Sources                        |
| :-: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: | :-----------------------: | :---------------------------------------------------: |
|  1  | Verify: Session related events are logged such as creation, renewable, and destruction </br> Reason: Helps in detecting and investigating security incidences                                |   High   |  `Insufficient Logging`   |             [SMCS](#SMCS), [ASVS](#ASVS)              |
|  2  | Verify: The session ID is never trusted and is always validated for malicious input before processing it </br> Reason: Protection against injection and denial of service attacks            |   High   |    `Injection`, `DoS`     |                     [SMCS](#SMCS)                     |
|  3  | Verify: Session ID exchange takes place over TLS (HTTPS) </br> Reason: Encrypted channel that prevent eavesdropping                                                                          |   High   |      `Eavesdropping`      | [SMCS](#SMCS), [ASVS](#ASVS), [SP800-63B](#SP800-63B) |
|  4  | Verify: Rate-limiting mechanisms exist on the session ID</br> Reason: Prevention against guessing and Denial of Service (DoS)                                                                |  Medium  |   `Bruteforcing`, `DoS`   |                          ⛔                           |
|  5  | Verify: If a library is used for session management, ensure it is not misconfigured </br> Reason: Default configurations or misconfigurations can grant unauthorized access to an attacker   |   High   |    `Misconfiguration`     |                          ⛔                           |
|  6  | Verify: Libraries used for session management are not vulnerable </br> Reason: An attacker can use the vulnerable library to escalate their privileges                                       |   High   | `Vulnerable Dependencies` |                          ⛔                           |
|  7  | Verify: The application never reveals session ID in URL parameters or error messages </br> Reason: An attacker can steal this information and hijack someone's session                       |  Medium  | `Information Disclosure`  |                     [ASVS](#ASVS)                     |
|  8  | Verify: A new session is generated when privileges change or sensitive features are performed, such as resetting passwords </br> Reason: Added security in case current session was hijacked |  Medium  |      `Impersonation`      |             [SMCS](#SMCS), [ASVS](#ASVS)              |
|  9  | Verify: The user is notified when a new session is generated from a new device or location </br> Reason: In case an unwanted login occurs from another device or a location, the user knows  |  Medium  |      `Impersonation`      |                          ⛔                           |

---

## Session in Production

|  #  | Items                                                                                                                                                                                                                                                        | Severity |                   Attacks                    | Sources |
| :-: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------: | :------------------------------------------: | :-----: |
|  1  | Verify: There's a process for invalidating sessions in the event of a security breach </br> Reason: Prevent an attacker from having prolonged access                                                                                                         |   High   |             `Session Hijacking`              |   ⛔    |
|  2  | Verify: Audit logs are monitored regularly for anomalies </br> Reason: Identify attacks that were attempted on a user's account                                                                                                                              |   High   |             `Session Hijacking`              |   ⛔    |
|  3  | Verify: Third party software or libraries used for session management are updated to the most recent version and are regularly patched </br> Reason: Vulnerability in a third party resource can grant an attacker unauthorized access                       |   High   | `Session Hijacking`, `Vulnerable Dependency` |   ⛔    |
|  4  | Verify: Conduct regular security assessments, vulnerability scans, and penetration testing to identify vulnerabilities in custom and third-party code </br> Reason: Identify any security vulnerabilities that might have appeared in session implementation |   High   |             `Session Hijacking`              |   ⛔    |

---

Sources:

Open Web Application Security Project (OWASP):

-   <a href="https://github.com/OWASP/ASVS/blob/master/4.0/en/0x12-V3-Session-management.md" target="_blank" id="ASVS">[ASVS] Application Security Verification Standard - Session Management</a>
-   <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html" target="_blank" id="SMCS">[SMCS] Session Management Cheat Sheet</a>

National Institute of Standards and Technology (NIST):

-   <a href="https://pages.nist.gov/800-63-3/sp800-63b.html#7-session-management" target="_blank" id="SP800-63B">[SP800-63B] 7 Session Management</a>
